<!DOCTYPE html>
<html>
<head><title>Force Auth Debug</title></head>
<body>
    <h1>Forced Auth Check</h1>
    <div id="result"></div>
    <script>
        async function forceTest() {
            console.log('FORCE TEST: Starting...');
            const result = document.getElementById('result');
            
            try {
                result.innerHTML = 'Testing /api/auth/user...';
                const res = await fetch('/api/auth/user', { credentials: 'include' });
                const data = await res.json();
                
                result.innerHTML = `
                    <p>Status: ${res.status}</p>
                    <p>Data: ${JSON.stringify(data)}</p>
                    <p>Expected: ok=false, authenticated=false</p>
                    <p>Match: ${data.ok === false && data.authenticated === false ? 'YES' : 'NO'}</p>
                `;
                
                console.log('FORCE TEST: Response:', { status: res.status, data });
                
                // Now check if React app is calling the API
                console.log('FORCE TEST: Checking React app behavior...');
                setTimeout(() => {
                    const authLogs = [];
                    const oldLog = console.log;
                    console.log = (...args) => {
                        if (args.some(arg => typeof arg === 'string' && arg.includes('AuthProvider'))) {
                            authLogs.push(args.join(' '));
                        }
                        oldLog.apply(console, args);
                    };
                    
                    setTimeout(() => {
                        result.innerHTML += `<h3>React Auth Logs:</h3><pre>${authLogs.join('\n')}</pre>`;
                        console.log = oldLog;
                    }, 2000);
                }, 100);
                
            } catch (err) {
                result.innerHTML = `Error: ${err.message}`;
                console.error('FORCE TEST: Error:', err);
            }
        }
        
        forceTest();
    </script>
</body>
</html>