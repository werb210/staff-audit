{
  "routes": [
    {
      "path": "/staff/pipeline",
      "component": "client/src/pipeline/PipelinePage.tsx",
      "drawer": false,
      "purpose": "Main Kanban board with all pipeline cards"
    },
    {
      "path": "/staff/pipeline/:cardId",
      "component": "client/src/pipeline/SimpleDrawer.tsx",
      "drawer": true,
      "purpose": "Application detail drawer with tabs"
    }
  ],
  "tabs": [
    {
      "key": "details",
      "label": "Details",
      "component": "client/src/pipeline/DetailsTab.tsx",
      "apis": ["GET /api/pipeline/cards/:id"],
      "purpose": "Display application information in grid layout",
      "actions": []
    },
    {
      "key": "timeline",
      "label": "Timeline", 
      "component": "client/src/pipeline/TimelineTab.tsx",
      "apis": ["GET /api/pipeline/cards/:id/timeline"],
      "purpose": "Show activity history and audit trail",
      "actions": []
    },
    {
      "key": "ocr",
      "label": "OCR Conflicts",
      "component": "client/src/pipeline/OCRConflictsTab.tsx", 
      "apis": ["GET /api/pipeline/cards/:id/ocr-conflicts"],
      "purpose": "Document analysis and conflict resolution",
      "actions": ["select_document", "toggle_comparison", "resolve_conflicts"]
    },
    {
      "key": "lenders",
      "label": "Lender Recs",
      "component": "client/src/pipeline/LenderRecsTab.tsx",
      "apis": ["GET /api/pipeline/cards/:id/recommendations", "POST /api/pipeline/cards/:id/recommendations"],
      "purpose": "Send applications to lenders and track status",
      "actions": ["send_to_lender", "track_status"]
    }
  ],
  "apis": [
    {
      "method": "GET",
      "path": "/api/pipeline/board",
      "request": {"params": []},
      "response": {"lanes": [{"id": "string", "label": "string", "items": "Card[]"}]},
      "usedBy": ["pipeline_board"],
      "caching": "no-cache",
      "fallback": "/api/pipeline/cards"
    },
    {
      "method": "GET", 
      "path": "/api/pipeline/cards",
      "request": {"params": []},
      "response": {"data": "Card[]"},
      "usedBy": ["pipeline_board_fallback"],
      "caching": "no-cache"
    },
    {
      "method": "GET",
      "path": "/api/pipeline/cards/:id",
      "request": {"params": ["id"]},
      "response": {"item": "ApplicationDetails"},
      "usedBy": ["details_tab"],
      "auth": "staff_required"
    },
    {
      "method": "GET", 
      "path": "/api/pipeline/cards/:id/application",
      "request": {"params": ["id"]},
      "response": {"application": "object", "contact": "object", "documentCount": "number"},
      "usedBy": ["drawer_content"],
      "auth": "staff_required"
    },
    {
      "method": "GET",
      "path": "/api/pipeline/cards/:id/timeline", 
      "request": {"params": ["id"]},
      "response": {"items": [{"at": "timestamp", "event": "string", "meta": "object"}]},
      "usedBy": ["timeline_tab"],
      "auth": "staff_required"
    },
    {
      "method": "GET",
      "path": "/api/pipeline/cards/:id/ocr-conflicts",
      "request": {"params": ["id"]},
      "response": {"documents": "array", "conflicts": "array", "fieldSummary": "object"},
      "usedBy": ["ocr_tab"],
      "auth": "staff_required"
    },
    {
      "method": "GET",
      "path": "/api/pipeline/cards/:id/recommendations",
      "request": {"params": ["id"]},
      "response": {"items": [{"id": "string", "lenderId": "string", "status": "string", "updatedAt": "string"}]},
      "usedBy": ["lender_recs_tab"],
      "auth": "staff_required"
    },
    {
      "method": "POST",
      "path": "/api/pipeline/cards/:id/recommendations",
      "request": {"params": ["id"], "body": {"lenderId": "string"}},
      "response": {"success": "boolean"},
      "usedBy": ["lender_recs_tab"],
      "auth": "staff_required"
    }
  ],
  "workflows": [
    {
      "name": "Open Application Card",
      "triggers": ["click_card", "double_click_card", "click_open_button"],
      "sideEffects": ["navigate_to_card_url", "open_drawer", "load_application_data"],
      "components": ["PipelineCard", "SimpleDrawer"]
    },
    {
      "name": "Send to Lender",
      "triggers": ["click_send_button"],
      "sideEffects": ["prompt_lender_id", "POST /api/pipeline/cards/:id/recommendations", "refresh_recommendations"],
      "components": ["LenderRecsTab"]
    },
    {
      "name": "Close Application Detail",
      "triggers": ["click_close", "click_overlay"],
      "sideEffects": ["navigate_to_pipeline", "close_drawer"],
      "components": ["SimpleDrawer"]
    }
  ],
  "documents": [
    {
      "uploadPath": "/api/documents/upload",
      "limits": {"sizeMB": 25, "types": ["pdf", "jpg", "png"]},
      "security": ["virus_scan", "file_validation", "secure_filename"],
      "storage": "s3_aes256"
    },
    {
      "uploadPath": "/api/bulletproof/upload/:applicationId", 
      "limits": {"sizeMB": 25},
      "security": ["enhanced_validation", "duplicate_detection"],
      "storage": "s3_aes256"
    }
  ],
  "ocr": [
    {
      "service": "multiple_providers",
      "providers": ["Textract", "Tesseract"], 
      "confidenceThreshold": 0.8,
      "fieldsMapped": ["amount", "date", "account", "business_name"],
      "processing": "async_queue",
      "manualReview": true
    }
  ],
  "integrations": [
    {
      "type": "sms",
      "provider": "Twilio", 
      "paths": ["/api/auth/request-2fa", "/api/auth/verify-2fa"],
      "status": "operational"
    },
    {
      "type": "email",
      "provider": "SendGrid",
      "paths": ["/api/communications/email"],
      "status": "operational"
    },
    {
      "type": "websocket",
      "provider": "Socket.IO",
      "paths": ["/ws"],
      "events": ["pipeline_update", "status_change"],
      "status": "operational"
    },
    {
      "type": "calendar",
      "provider": "Microsoft Graph O365",
      "paths": ["/api/calendar/*"],
      "status": "configured"
    }
  ],
  "security": [
    {
      "role": "admin",
      "tabs": ["details", "timeline", "ocr", "lenders"],
      "actions": ["view", "edit", "send_lender", "manage_users"]
    },
    {
      "role": "staff", 
      "tabs": ["details", "timeline", "ocr", "lenders"],
      "actions": ["view", "send_lender"]
    },
    {
      "role": "lender",
      "tabs": [],
      "actions": []
    },
    {
      "role": "client",
      "tabs": [],
      "actions": []
    }
  ],
  "telemetry": [
    {
      "event": "card_opened",
      "props": ["cardId", "tab", "user_id"],
      "component": "PipelineCard"
    },
    {
      "event": "tab_switched", 
      "props": ["from_tab", "to_tab", "cardId"],
      "component": "SimpleDrawer"
    },
    {
      "event": "lender_recommendation_sent",
      "props": ["cardId", "lenderId", "user_id"],
      "component": "LenderRecsTab"
    }
  ],
  "flags": [
    {
      "name": "WS_ALLOW_DEV_NO_TOKEN",
      "default": "0",
      "purpose": "Allow WebSocket connections without auth in development"
    },
    {
      "name": "API_BASE_URL",
      "default": "http://localhost:5000",
      "purpose": "Base URL for API requests"
    },
    {
      "name": "VITE_API_BASE_URL", 
      "default": "undefined",
      "purpose": "Frontend API base URL override"
    }
  ],
  "knownGood": [
    {
      "area": "Pipeline Board",
      "note": "63 cards loading correctly across 6 stages",
      "repro": "Navigate to /staff/pipeline, verify cards display"
    },
    {
      "area": "Card Navigation",
      "note": "Click-to-open drawer system working reliably", 
      "repro": "Click any card, verify drawer opens with details"
    },
    {
      "area": "API Fallback System",
      "note": "Board → Cards → Demo data fallback operational",
      "repro": "Check network tab, verify API response chain"
    },
    {
      "area": "Tab Navigation",
      "note": "All 4 tabs load without errors",
      "repro": "Open card drawer, switch between Details/Timeline/OCR/Lenders tabs"
    },
    {
      "area": "Data Formatting",
      "note": "Currency, phone, date formatting working",
      "repro": "View card details, verify $50,000 amounts and (555) 123-4567 phones"
    }
  ],
  "knownBroken": [
    {
      "area": "Timeline Data",
      "note": "Timeline tab returns empty/demo data only", 
      "repro": "Open card → Timeline tab, see 'No activity yet' message"
    },
    {
      "area": "OCR Processing",
      "note": "Limited real OCR data, mostly placeholders",
      "repro": "Open card → OCR Conflicts tab, limited conflict data"
    },
    {
      "area": "Application Editing",
      "note": "All tabs read-only, no edit capabilities",
      "repro": "Open any tab, no edit buttons or form fields available"
    },
    {
      "area": "External Lender APIs",
      "note": "Lender recommendation POST works but no external integration",
      "repro": "Send recommendation, succeeds locally but no external API call"
    },
    {
      "area": "Document Upload Integration", 
      "note": "Upload endpoints exist but pipeline integration unclear",
      "repro": "Try uploading document from pipeline card context"
    }
  ]
}